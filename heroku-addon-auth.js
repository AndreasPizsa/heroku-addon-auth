// Generated by CoffeeScript 1.8.0
(function() {
  module.exports = function(options) {
    var log, manifest, manifestName, path, restify;
    log = options.log, manifest = options.manifest;
    if (!log) {
      log = console;
    }
    if (!manifest) {
      path = require('path');
      manifestName = path.dirname(require.main.filename) + path.sep + 'addon-manifest.json';
      manifest = require(manifestName);
    }
    restify = require('restify');
    return function(req, res, next) {
      var auth, errorMessage, _ref;
      if (!req.authorization) {
        path = require('path');
        errorMessage = "Authorization middleware must be use()d before " + (path.basename(module.filename, '.litcoffee')) + ", e.g. server.use(restify.authorizationParser()).";
        console.log(errorMessage);
        return next(new restify.errors.InternalError(errorMessage));
      }
      auth = (_ref = req.authorization) != null ? _ref.basic : void 0;
      if (!auth || auth.username !== manifest.id || auth.password !== manifest.api.password) {
        return next(new restify.errors.UnauthorizedError);
      }
      return next();
    };
  };

}).call(this);
